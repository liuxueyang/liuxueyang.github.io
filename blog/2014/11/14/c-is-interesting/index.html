<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>C is Interesting &middot; 黑历史</title>

  
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/poole.css">
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/hyde.css">
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/poole-overrides.css">
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/hyde-overrides.css">
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/hyde-x.css">
  <link rel="stylesheet" href="http://liuxueyang.github.io/css/highlight/sunburst.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://liuxueyang.github.io/touch-icon-144-precomposed.png">
  <link href="http://liuxueyang.github.io/favicon.png" rel="icon">

  
  
  
  

  <meta name="description" content="This is my Notes">
  <meta name="keywords" content="Notes,Diary">
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1>黑历史</h1>
      <p class="lead">THE LAST ONE.</p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item"><a href="http://liuxueyang.github.io/">Blog</a></li>
      
    </ul>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
      <a href="http://github.com/liuxueyang"><i class="fa fa-github-square fa-3x"></i></a>
      
      
      
      
      
      
      
      
      </li>
    </ul>

    

    <p>Copyright &copy; 2017 <a href="http://liuxueyang.github.io/license/">License</a><br/>
       Powered by <a href="http://gohugo.io">Hugo</a> and <a href="https://github.com/zyro/hyde-x">Hyde-X</a></p>
  </div>
</div>


<div class="content container">
  <div class="post">
    <h1 class="post-title">C is Interesting</h1>
    <span class="post-date">Nov 14, 2014 &middot; 2 minute read &middot; <a href="http://liuxueyang.github.io/blog/2014/11/14/c-is-interesting/#disqus_thread">Comments</a>
    </span>
    <p>最近偶尔看C语言，看了一点有意思的东西。</p>

<ul>
<li>C语言里函数声明有一个很有意思的现象：</li>
</ul>

<p>如果一个函数没有float, short, 或者char类型的参数，在函数生命中完全可以省略
参数类型的说明（但是函数定义中不可以省略）。</p>

<p>也就是说有一个函数定义：</p>

<pre><code class="language-c">double double(double a)
{
	return a * a;
}
</code></pre>

<p>那么这个函数可以声明为：</p>

<pre><code class="language-c">double square();
</code></pre>

<p>这个规则好像是为了兼容旧版本的C吧。</p>

<ul>
<li>一个例子：</li>
</ul>

<pre><code class="language-c">/*
 * =====================================================================================
 *       Filename : type_scanf.c
 *    Description : This program outputs differently on different systems.
 *    Version     : 
 *        Created : 11/12/14 22:45
 *         Author : Liu Xue Yang (LXY), liuxueyang457@163.com
 *         Motto  : Suicide is Painless
 * =====================================================================================
 */
#include &lt;stdio.h&gt;
main()
{
	int i;
	char c;

	for ( i = 0; i &lt; 5; ++i ) {
		scanf ( &quot;%d&quot;, &amp;c );
		printf ( &quot;%d\n&quot;, i );
	}
	printf ( &quot;\n&quot; );
}
</code></pre>

<p>这个函数的输出是什么呢？
仔细想一想，其实一种情况的输入和输出如下：</p>

<pre><code class="language-bash">c~&gt;./type_scanf 
1
0
2
0
128
0
256
1
512
2
3
4
</code></pre>

<p>从这个输出可以看出，编译器把整型i放到了char型c的后面，这个系统是小端存储。说起这个小
端和大端，那天看到一本书这么解释，我感觉比较好：</p>

<pre><code>小端存储就是小端优先，先存数值的低位，也就是小的一端；
大端存储就是大端优先，先存数值的高位，也就是大的一段；
</code></pre>

<p>以前总是搞不清或者搞反了，这次记住了。。。另外就是，写个程序判断当前系统是小端还是大端
其实也是很简单的。思想就是利用指针的强制类型转换。这里不写了，以后也许补上，我还要早睡。</p>

<p>我自己想到一个问题：</p>

<p>举出几个例子，使得体现“本来错误的程序因为某种巧合却能够工作”这一点。</p>

<p>其实有很多吧，先放到这里，以后再加上。</p>

<p>在某些系统中，下面的程序打印出%g，这是为什么呢？</p>

<pre><code class="language-c">#include &lt;stdio.h&gt;
main()
{
	printf(&quot;%g\n&quot;, sqrt(2));
}
</code></pre>

<p>这个问题在C陷阱里面解释的很好，恍然大悟。</p>

<ul>
<li>宏定义</li>
</ul>

<p>我觉得最容易出错的一点就是，在一个宏里面，一个变量被求值超过一次，这是很危险的。举
个简单的例子，经常看到有人这么写：</p>

<pre><code class="language-c">#define max(a,b) ((a) &gt;(b) ? (a) : (b))
</code></pre>

<p>万一有个倒霉蛋类似于下面这么用，那结果就不对了咯。</p>

<pre><code class="language-c">int a[10];
int *p = a;
int n;
int tmp = max(*p++, n);
</code></pre>

<p>还有很多种情况，因为多次求值而出现问题的，比如，早期的库函数toupper有一种宏实现：</p>

<pre><code class="language-c">#define toupper(c) \
	((c) &gt;= 'a' &amp;&amp; (c) &lt;= 'z' ? (c) - 'a' + 'A' : (c))
</code></pre>

<p>这个也同样存在问题。</p>

<p>宏另外还有一个要注意的问题是，宏定义时候的空格！比如：</p>

<pre><code class="language-c">#define f (x) ((x) - 1)
#define g(x) ((x) - 1)
</code></pre>

<p>这两个完全不一样哦！但是，调用的时候却没有这个规则，也就是说我们可以：</p>

<pre><code class="language-c">int a = 1;
g(a) == g (a)
</code></pre>

<ul>
<li>typedef</li>
</ul>

<p>一个很早之前就知道的一件事儿是：</p>

<pre><code class="language-c">#define FOO struct foo *
typedef struct foo * PFOO;

FOO a, b;
PFOO c, d;
</code></pre>

<p>a是指针，b是结构。c，d都是指针。道理很简单。</p>

<ul>
<li><p>有符号整数的向右移位运算并不等同于除以2的某次幂。(-1)&gt;&gt;1一般不可能是0(gcc上结果是－1)，但是(-1)/2却一般都是0.</p></li>

<li><p>关于取余。</p></li>
</ul>

<p>q = a / b;
r = a % b;
不妨假设b &gt; 0;</p>

<p>我们一般希望满足三点：</p>

<pre><code>1. q * b + r == a
2. 若改变a的正负号，那么这会改变q的符号，但是q的绝对值不变
3. 当b &gt; 0 时，r &gt;= 0 &amp;&amp; r &lt; b
</code></pre>

<p>有趣的是，这三个性质不可能同时成立。这货明天再写，今天晚了，我要早睡！23:26了。。。。</p>

<p>最后两句：</p>

<p>以前看书都不怎么做笔记的，偶尔拿起钢笔写字才想起来自己很久不好好写字了，干脆读书的时候写写笔记什么的吧。然后就入了两个英雄616做读书笔记，这笔确实品控差，所以入了pilot 78G和lamy Safari。没舍得入鱼水，入了百利金。</p>

<p>最近校招。不想多说什么，招人不容易，求职也不容易。</p>

<p>这篇博客未完，先放在这里，以后有时间再说吧。睡觉了。。。。早睡早起。身体最重要。</p>

  </div>
  <div id="disqus_thread"></div>
</div>


<script type="text/javascript">
var disqus_shortname = "abeliu";
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>



<script type="text/javascript">
    var disqus_shortname = "abeliu";
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

<script src="http://liuxueyang.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>

