<!DOCTYPE html>
<html lang="zh-TW">
<head>
<!-- 2019-02-09 Sat 20:26 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lists</title>
<meta name="generator" content="Org mode">
<meta name="author" content="liuxueyang">
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
 <link rel='stylesheet' title='Standard' href='/views/css/worg.css' type='text/css' />
 <link rel='alternate stylesheet' title='Zenburn' href='/views/css/worg-zenburn.css' type='text/css' />
 <link rel='alternate stylesheet' title='Classic' href='/views/css/worg-classic.css' type='text/css' />

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src='https://www.googletagmanager.com/gtag/js?id=UA-123066567-1'></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-123066567-1');
</script>

<link rel='apple-touch-icon' sizes='57x57' href='./images/favicon/apple-icon-57x57.png'>
<link rel='apple-touch-icon' sizes='60x60' href='./images/favicon/apple-icon-60x60.png'>
<link rel='apple-touch-icon' sizes='72x72' href='./images/favicon/apple-icon-72x72.png'>
<link rel='apple-touch-icon' sizes='76x76' href='./images/favicon/apple-icon-76x76.png'>
<link rel='apple-touch-icon' sizes='114x114' href='./images/favicon/apple-icon-114x114.png'>
<link rel='apple-touch-icon' sizes='120x120' href='./images/favicon/apple-icon-120x120.png'>
<link rel='apple-touch-icon' sizes='144x144' href='./images/favicon/apple-icon-144x144.png'>
<link rel='apple-touch-icon' sizes='152x152' href='./images/favicon/apple-icon-152x152.png'>
<link rel='apple-touch-icon' sizes='180x180' href='./images/favicon/apple-icon-180x180.png'>
<link rel='icon' type='image/png' sizes='192x192'  href='./images/favicon/android-icon-192x192.png'>
<link rel='icon' type='image/png' sizes='32x32' href='./images/favicon/favicon-32x32.png'>
<link rel='icon' type='image/png' sizes='96x96' href='./images/favicon/favicon-96x96.png'>
<link rel='icon' type='image/png' sizes='16x16' href='./images/favicon/favicon-16x16.png'>
<link rel='manifest' href='./images/favicon/manifest.json'>
<meta name='msapplication-TileColor' content='#ffffff'>
<meta name='msapplication-TileImage' content='/ms-icon-144x144.png'>
<meta name='theme-color' content='#ffffff'>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2018 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="javascript:history.back()"> 返回 </a>
 |
 <a accesskey="H" href="/"> 主頁 </a>
</div><div id="content">
<header>
<h1 class="title">Lists</h1>
</header><nav id="table-of-contents">
<h2>&#30446;&#37636;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org3680162">1. <span class="done DONE">DONE</span> Conses</a></li>
<li><a href="#org546464d">2. <span class="done DONE">DONE</span> Equality</a></li>
<li><a href="#org11d3d2e">3. <span class="done DONE">DONE</span> Why Lisp Has No Pointers</a></li>
<li><a href="#org25cc59b">4. <span class="done DONE">DONE</span> Building Lists</a></li>
<li><a href="#orgafc9724">5. <span class="done DONE">DONE</span> Example: Compression</a></li>
<li><a href="#orgf8b7a62">6. <span class="done DONE">DONE</span> Access</a></li>
<li><a href="#orga4e92f5">7. <span class="done DONE">DONE</span> Mapping Functions</a></li>
<li><a href="#org578022e">8. <span class="done DONE">DONE</span> Trees</a></li>
<li><a href="#org18d2d0b">9. <span class="done DONE">DONE</span> Understanding Recursion</a></li>
<li><a href="#org18dfc0d">10. <span class="done DONE">DONE</span> Sets</a></li>
<li><a href="#org81bdedd">11. <span class="done DONE">DONE</span> Sequences</a></li>
<li><a href="#org094467b">12. <span class="done DONE">DONE</span> Stacks</a></li>
<li><a href="#org5c2d133">13. <span class="done DONE">DONE</span> Dotted Lists</a></li>
<li><a href="#org315438f">14. <span class="done DONE">DONE</span> Assoc-lists</a></li>
<li><a href="#orgce0994b">15. <span class="done DONE">DONE</span> Example: Shortest Path</a></li>
<li><a href="#orgb9cc677">16. <span class="done DONE">DONE</span> Garbage</a></li>
<li><a href="#org13b73a5">17. <span class="todo TODO">TODO</span> Exercise</a>
<ul>
<li><a href="#org50898c4">17.1. <span class="done DONE">DONE</span> Problem One</a></li>
<li><a href="#orgae3f555">17.2. <span class="done DONE">DONE</span> Problem Two</a></li>
<li><a href="#org1009b71">17.3. <span class="done DONE">DONE</span> Problem Three</a></li>
<li><a href="#orga58e06b">17.4. <span class="done DONE">DONE</span> Problem Four</a></li>
<li><a href="#org8df58ac">17.5. <span class="done DONE">DONE</span> Problem Five</a></li>
<li><a href="#org503bfa9">17.6. <span class="todo TODO">TODO</span> Problem Six</a></li>
<li><a href="#org78f7f44">17.7. <span class="done DONE">DONE</span> Problem Seven</a></li>
<li><a href="#org5559a76">17.8. <span class="done DONE">DONE</span> Problem Eight</a></li>
<li><a href="#org5103d70">17.9. <span class="todo TODO">TODO</span> Problem Nine</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-org3680162" class="outline-2">
<h2 id="org3680162"><span class="section-number-2">1</span> <span class="done DONE">DONE</span> Conses</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:04]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-21 Tue 15:49]--[2018-08-21 Tue 16:04] </span> <span class="timestamp">(0:15)</span>
</span>
</p>

<p>
本質上， <code>cons</code> 其實就是一對指針：第一個是 <code>car</code> ，第二個是 <code>cdr</code>
。 <code>car</code> 和 <code>cdr</code> 這兩個函數分別可以得到這兩個指針指向的對象。
</p>

<p>
<code>consp</code> 判斷一個對象是不是 <code>cons</code> ，可以定義判斷對象是否是列表的函數：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-listp</span> <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>or <span class="org-rainbow-delimiters-depth-3">(</span>null x<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>consp x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
任何非 <code>cons</code> 的對象都是 <code>atom</code> ，可以定義判斷一個對象是不是 <code>atom</code>
的函數：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-atom</span> <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>not <span class="org-rainbow-delimiters-depth-3">(</span>consp x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>nil</code> 既是列表也是 <code>atom</code> 。
</p>
</div>
</div>

<div id="outline-container-org546464d" class="outline-2">
<h2 id="org546464d"><span class="section-number-2">2</span> <span class="done DONE">DONE</span> Equality</h2>
<div class="outline-text-2" id="text-2">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:27]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:05]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-21 Tue 16:05]--[2018-08-21 Tue 16:27] </span> <span class="timestamp">(0:22)</span>
</span>
</p>

<p>
當調用 <code>cons</code> 的時候，Lisp 會創建兩個新的指針，所以下面兩個 <code>cons</code>
其實是不同的對象：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>eql <span class="org-rainbow-delimiters-depth-2">(</span>cons 'a nil<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>cons 'a nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
</pre>
</div>

<p>
如果想要判斷兩個對象是否相等，可以使用 <code>equal</code> 函數：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>setf xx <span class="org-rainbow-delimiters-depth-2">(</span>cons 'a nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>eql xx xx<span class="org-rainbow-delimiters-depth-1">)</span>
T
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>equal xx <span class="org-rainbow-delimiters-depth-2">(</span>cons 'a nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>eql xx <span class="org-rainbow-delimiters-depth-2">(</span>cons 'a nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
</pre>
</div>

<ul class="org-ul">
<li><code>eql</code> 函數用來判斷兩個對象是不是同一個。</li>
<li><code>equal</code> 函數用來判斷兩個對象是不是相等。</li>
</ul>

<p>
可以使用 <code>eql</code> 定義 <code>equal</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-equal</span> <span class="org-rainbow-delimiters-depth-2">(</span>x y<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>or <span class="org-rainbow-delimiters-depth-3">(</span>eql x y<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>and <span class="org-rainbow-delimiters-depth-4">(</span>consp x<span class="org-rainbow-delimiters-depth-4">)</span>
           <span class="org-rainbow-delimiters-depth-4">(</span>consp y<span class="org-rainbow-delimiters-depth-4">)</span>
           <span class="org-rainbow-delimiters-depth-4">(</span>our-equal <span class="org-rainbow-delimiters-depth-5">(</span>car x<span class="org-rainbow-delimiters-depth-5">)</span>
                      <span class="org-rainbow-delimiters-depth-5">(</span>car y<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
           <span class="org-rainbow-delimiters-depth-4">(</span>our-equal <span class="org-rainbow-delimiters-depth-5">(</span>cdr x<span class="org-rainbow-delimiters-depth-5">)</span>
                      <span class="org-rainbow-delimiters-depth-5">(</span>cdr y<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org11d3d2e" class="outline-2">
<h2 id="org11d3d2e"><span class="section-number-2">3</span> <span class="done DONE">DONE</span> Why Lisp Has No Pointers</h2>
<div class="outline-text-2" id="text-3">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-21 Tue 16:28]--[2018-08-21 Tue 16:40] </span> <span class="timestamp">(0:12)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:41]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:28]</span></span></li>
</ul>

<p>
如果要理解 Lisp，很重要的一點是要意識到：就像列表通過 <code>cons</code> 裏面的指針包含元素一樣，變量也通過指針來保存對象。
</p>

<p>
有些語言允許顯示地操作指針，在 Lisp 中，語言本身把指針操作隱藏在底層。
</p>

<p>
把一個變量賦值給另外一個變量的時候，實際上複製的只是指針，而不是對象本身：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>setf x '<span class="org-rainbow-delimiters-depth-2">(</span>a b c d<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A B C D<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>setf y x<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A B C D<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>eql x y<span class="org-rainbow-delimiters-depth-1">)</span>
T
</pre>
</div>

<p>
有些時候，Lisp 可能會爲了性能考慮不使用指針而直接拷貝值，比如較小範圍的整數。
</p>
</div>
</div>

<div id="outline-container-org25cc59b" class="outline-2">
<h2 id="org25cc59b"><span class="section-number-2">4</span> <span class="done DONE">DONE</span> Building Lists</h2>
<div class="outline-text-2" id="text-4">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-21 Tue 16:41]--[2018-08-21 Tue 17:05] </span> <span class="timestamp">(0:24)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 17:05]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-21 Tue 16:41]</span></span></li>
</ul>

<p>
函數 <code>copy-list</code> 可以拷貝整個列表，而不只是拷貝指針。實現
<code>copy-list</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-copy-list</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>atom lst<span class="org-rainbow-delimiters-depth-3">)</span>
      lst
      <span class="org-rainbow-delimiters-depth-3">(</span>cons <span class="org-rainbow-delimiters-depth-4">(</span>our-copy-list <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
            <span class="org-rainbow-delimiters-depth-4">(</span>our-copy-list <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
書上實現如下，裏面有點兒問題，大概是僅僅考慮到了拷貝 <code>flat</code> 列表：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-copy-list-v2</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>atom lst<span class="org-rainbow-delimiters-depth-3">)</span>
      lst
      <span class="org-rainbow-delimiters-depth-3">(</span>cons <span class="org-rainbow-delimiters-depth-4">(</span>car lst<span class="org-rainbow-delimiters-depth-4">)</span>
            <span class="org-rainbow-delimiters-depth-4">(</span>our-copy-list-v2 <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
如果是嵌套列表的話，書上的實現就有問題了，比如內層的列表就沒有拷貝：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt;
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>x '<span class="org-rainbow-delimiters-depth-4">(</span>a b c<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"original x = ~a~%"</span> x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>y `<span class="org-rainbow-delimiters-depth-5">(</span>e ,x<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>format t <span class="org-string">"y = ~a~%"</span> y<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>y1 <span class="org-rainbow-delimiters-depth-6">(</span>our-copy-list y<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
          <span class="org-rainbow-delimiters-depth-5">(</span>y2 <span class="org-rainbow-delimiters-depth-6">(</span>our-copy-list-v2 y<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"y1 = ~a~%"</span> y1<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"y2 = ~a~%"</span> y2<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>setf <span class="org-rainbow-delimiters-depth-5">(</span>cadr x<span class="org-rainbow-delimiters-depth-5">)</span> 'z<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"changed x = ~a~%"</span> x<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"y1 = ~a~%"</span> y1<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"y2 = ~a~%"</span> y2<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

original x = <span class="org-rainbow-delimiters-depth-1">(</span>A B C<span class="org-rainbow-delimiters-depth-1">)</span>
y = <span class="org-rainbow-delimiters-depth-1">(</span>E <span class="org-rainbow-delimiters-depth-2">(</span>A B C<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
y1 = <span class="org-rainbow-delimiters-depth-1">(</span>E <span class="org-rainbow-delimiters-depth-2">(</span>A B C<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
y2 = <span class="org-rainbow-delimiters-depth-1">(</span>E <span class="org-rainbow-delimiters-depth-2">(</span>A B C<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
changed x = <span class="org-rainbow-delimiters-depth-1">(</span>A Z C<span class="org-rainbow-delimiters-depth-1">)</span>
y1 = <span class="org-rainbow-delimiters-depth-1">(</span>E <span class="org-rainbow-delimiters-depth-2">(</span>A B C<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
y2 = <span class="org-rainbow-delimiters-depth-1">(</span>E <span class="org-rainbow-delimiters-depth-2">(</span>A Z C<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
</pre>
</div>

<p>
<code>append</code> 函數可以連接任意個列表，但是不會改變任何一個列表：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>x '<span class="org-rainbow-delimiters-depth-4">(</span>a b c<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>y '<span class="org-rainbow-delimiters-depth-4">(</span>1 2 3<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"x = ~a~%y = ~a~%"</span> x y<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"~a~%"</span> <span class="org-rainbow-delimiters-depth-3">(</span>append y x<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"x = ~a~%y = ~a~%"</span> x y<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgafc9724" class="outline-2">
<h2 id="orgafc9724"><span class="section-number-2">5</span> <span class="done DONE">DONE</span> Example: Compression</h2>
<div class="outline-text-2" id="text-5">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 10:40]--[2018-08-24 Fri 10:55] </span> <span class="timestamp">(0:15)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 10:55]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 10:38]</span></span></li>
</ul>

<p>
壓縮一個列表：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">n-elts</span> <span class="org-rainbow-delimiters-depth-2">(</span>n elt<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"create a sub compression"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>&gt; n 1<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>list n elt<span class="org-rainbow-delimiters-depth-3">)</span>
      elt<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">compr</span> <span class="org-rainbow-delimiters-depth-2">(</span>elt n lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"find and create compression"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>list <span class="org-rainbow-delimiters-depth-4">(</span>n-elts n elt<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>next <span class="org-rainbow-delimiters-depth-6">(</span>car lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-5">(</span>equal elt next<span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>compr elt <span class="org-rainbow-delimiters-depth-6">(</span>+ n 1<span class="org-rainbow-delimiters-depth-6">)</span> <span class="org-rainbow-delimiters-depth-6">(</span>cdr lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>cons <span class="org-rainbow-delimiters-depth-6">(</span>n-elts n elt<span class="org-rainbow-delimiters-depth-6">)</span>
                  <span class="org-rainbow-delimiters-depth-6">(</span>compr next 1 <span class="org-rainbow-delimiters-depth-7">(</span>cdr lst<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">compress</span> <span class="org-rainbow-delimiters-depth-2">(</span>x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"compress a list"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>consp x<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>compr <span class="org-rainbow-delimiters-depth-4">(</span>car x<span class="org-rainbow-delimiters-depth-4">)</span> 1 <span class="org-rainbow-delimiters-depth-4">(</span>cdr x<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      x<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
比如：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>compress '<span class="org-rainbow-delimiters-depth-2">(</span>a b b c c c d a<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A <span class="org-rainbow-delimiters-depth-2">(</span>2 B<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>3 C<span class="org-rainbow-delimiters-depth-2">)</span> D A<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
解壓縮一個列表：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">list-of</span> <span class="org-rainbow-delimiters-depth-2">(</span>n elt<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"make a list of n elts"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>zerop n<span class="org-rainbow-delimiters-depth-3">)</span>
      nil
      <span class="org-rainbow-delimiters-depth-3">(</span>cons elt <span class="org-rainbow-delimiters-depth-4">(</span>list-of <span class="org-rainbow-delimiters-depth-5">(</span>- n 1<span class="org-rainbow-delimiters-depth-5">)</span> elt<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">uncompress</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-doc">"uncompress a list"</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      nil
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>cur <span class="org-rainbow-delimiters-depth-6">(</span>car lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-5">(</span>consp cur<span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>append <span class="org-rainbow-delimiters-depth-6">(</span>apply #'list-of cur<span class="org-rainbow-delimiters-depth-6">)</span> <span class="org-rainbow-delimiters-depth-6">(</span>uncompress <span class="org-rainbow-delimiters-depth-7">(</span>cdr lst<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>cons cur <span class="org-rainbow-delimiters-depth-6">(</span>uncompress <span class="org-rainbow-delimiters-depth-7">(</span>cdr lst<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
比如：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>uncompress <span class="org-rainbow-delimiters-depth-2">(</span>compress '<span class="org-rainbow-delimiters-depth-3">(</span>a b b c c c d a<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A B B C C C D A<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgf8b7a62" class="outline-2">
<h2 id="orgf8b7a62"><span class="section-number-2">6</span> <span class="done DONE">DONE</span> Access</h2>
<div class="outline-text-2" id="text-6">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 10:58]--[2018-08-24 Fri 11:22] </span> <span class="timestamp">(0:24)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 11:22]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 10:58]</span></span></li>
</ul>

<p>
<code>nth</code> 用來取得列表的第 <code>n</code> 個元素；「下標從 0 開始」要取得第 <code>n</code> 個
<code>cdr</code> ，可以使用 <code>nthcdr</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>nthcdr 2 '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>nth 2 '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
C
</pre>
</div>

<p>
其實， <code>nth</code> 相當於 <code>nthcdr</code> 的 <code>car</code> 。如果不考慮錯誤處理，
<code>nthcdr</code> 可以這樣實現：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-nthcdr</span> <span class="org-rainbow-delimiters-depth-2">(</span>n lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>or <span class="org-rainbow-delimiters-depth-4">(</span>null lst<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>zerop n<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      lst
      <span class="org-rainbow-delimiters-depth-3">(</span>our-nthcdr <span class="org-rainbow-delimiters-depth-4">(</span>- n 1<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>cdr lst<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>zerop</code> 函數如果參數是 0 的話會返回 <code>true</code> 。
</p>

<p>
<code>last</code> 函數返回列表的最後一個 <code>cons</code> ，而不是列表的最後一個元素，如果想要得到最後一個元素，可以取 <code>last</code> 的 <code>car</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>last '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>C<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Common Lisp 定義了從 <code>first</code> 到 <code>tenth</code> 這些函數，用來取得列表中的元素，比如 <code>(second x)</code> 相當於 <code>(nth 1 x)</code> 。
</p>

<p>
Common Lisp 還定義了像 <code>caddr</code> 這樣的函數，即類似於 <code>cxr</code> 這樣的函數，
<code>x</code> 最多四位。在這些函數中，除了 <code>cadr</code> 這個函數經常使用以外，再長的都不建議使用。
</p>
</div>
</div>

<div id="outline-container-orga4e92f5" class="outline-2">
<h2 id="orga4e92f5"><span class="section-number-2">7</span> <span class="done DONE">DONE</span> Mapping Functions</h2>
<div class="outline-text-2" id="text-7">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 11:22]--[2018-08-24 Fri 11:32] </span> <span class="timestamp">(0:10)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 11:32]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 11:22]</span></span></li>
</ul>

<p>
最長用的一個函數： <code>mapcar</code> ，這個函數接受一個函數參數 A，然後一個或者多個列表 S，從 S 的每個列表中依次取出元素作爲函數 A 的參數，作爲結果列表的一個元素，直到 S 中有列表用完爲止。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>mapcar #'<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-3">(</span>x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>+ x 10<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
                 '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>11 12 13<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>mapcar #'list
                 '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span>
                 '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>A 1<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>B 2<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>C 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>maplist</code> 和 <code>mapcar</code> 一樣，接受同樣的參數，只不過它作用域每個列表的
<code>cdr</code> 而不是 <code>car</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>maplist #'list
                  '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span>
                  '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>A B C<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>1 2 3 4<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>B C<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>2 3 4<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>C<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>3 4<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org578022e" class="outline-2">
<h2 id="org578022e"><span class="section-number-2">8</span> <span class="done DONE">DONE</span> Trees</h2>
<div class="outline-text-2" id="text-8">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 14:14]--[2018-08-24 Fri 14:26] </span> <span class="timestamp">(0:12)</span>
</span>
</p>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 11:34]--[2018-08-24 Fri 11:53] </span> <span class="timestamp">(0:19)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 14:26]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 11:34]</span></span></li>
</ul>

<p>
<code>conses</code> 可以看作是二叉樹。
</p>

<p>
<code>copy-tree</code> 這個函數接收一個樹，然後返回這個樹的拷貝，可以這樣定義：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-copy-tree</span> <span class="org-rainbow-delimiters-depth-2">(</span>tr<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>atom tr<span class="org-rainbow-delimiters-depth-3">)</span>
      tr
      <span class="org-rainbow-delimiters-depth-3">(</span>cons <span class="org-rainbow-delimiters-depth-4">(</span>our-copy-tree <span class="org-rainbow-delimiters-depth-5">(</span>car tr<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
            <span class="org-rainbow-delimiters-depth-4">(</span>our-copy-tree <span class="org-rainbow-delimiters-depth-5">(</span>cdr tr<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
Common Lisp 包含樹的函數並不是因爲樹這種數據結構，而是爲了處理嵌套列表這種結構。「其實我感覺這兩種結構其實是一樣的」比如把一個列表中的
<code>x</code> 替換成 <code>y</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>substitute 'y 'x '<span class="org-rainbow-delimiters-depth-2">(</span>and <span class="org-rainbow-delimiters-depth-3">(</span>integerp x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>zerop <span class="org-rainbow-delimiters-depth-4">(</span>mod x 2<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>AND <span class="org-rainbow-delimiters-depth-2">(</span>INTEGERP X<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>ZEROP <span class="org-rainbow-delimiters-depth-3">(</span>MOD X 2<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
可以看出替換沒有效果，正確用法使用 <code>subst</code> 函數，這個函數替換樹中的元素：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>subst 'y 'x '<span class="org-rainbow-delimiters-depth-2">(</span>and <span class="org-rainbow-delimiters-depth-3">(</span>integerp x<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>zerop <span class="org-rainbow-delimiters-depth-4">(</span>mod x 2<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>AND <span class="org-rainbow-delimiters-depth-2">(</span>INTEGERP Y<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>ZEROP <span class="org-rainbow-delimiters-depth-3">(</span>MOD Y 2<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>subst</code> 函數的定義應該像下面這樣：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-subst</span> <span class="org-rainbow-delimiters-depth-2">(</span>new old tree<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>atom tree<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>equal old tree<span class="org-rainbow-delimiters-depth-4">)</span>
          new
          tree<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>cons <span class="org-rainbow-delimiters-depth-4">(</span>our-subst new old <span class="org-rainbow-delimiters-depth-5">(</span>car tree<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
            <span class="org-rainbow-delimiters-depth-4">(</span>our-subst new old <span class="org-rainbow-delimiters-depth-5">(</span>cdr tree<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
可以看出，它和 <code>our-copy-tree</code> 的定義很像，很多對樹的操作其實都是類似的結構：對 <code>car</code> 和 <code>cdr</code> 進行遞歸，這樣的結構叫做雙遞歸。
</p>
</div>
</div>
<div id="outline-container-org18d2d0b" class="outline-2">
<h2 id="org18d2d0b"><span class="section-number-2">9</span> <span class="done DONE">DONE</span> Understanding Recursion</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 14:54]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 14:26]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 14:26]--[2018-08-24 Fri 14:54] </span> <span class="timestamp">(0:28)</span>
</span>
</p>

<p>
有些人學習遞歸的時候，喜歡在紙上模擬遞歸的調用過程，其實這並不是一種好的方式。因爲程序員寫遞歸的時候，通常情況下並不是這樣思考的。
</p>

<p>
通過理解遞歸的調用過程來理解一個遞歸其實並沒有什麼幫助。遞歸的優勢在於，你可以用更加抽象的方式來思考算法。要理解一個遞歸算法，你只需要考慮兩方面：
</p>

<ol class="org-ol">
<li>驗證它是不是對所有的基本情況都是正確的；</li>
<li>驗證如果對於 n 是對的，那麼對於 n+1 的規模是不是對的；</li>
</ol>

<p>
這就是我們需要瞭解的全部東西。對於遞歸的全部調用細節，其實和對於 Lisp
中的括號有點兒類似，閱讀 Lisp 程序的時候，你不必去糾結哪個括號匹配哪個括號；同樣地，閱讀遞歸程序的時候，你也不必糾結全部的調用棧是怎樣的。
</p>

<p>
判斷一個遞歸算法是正確的只是理解遞歸的一半，另一半是如何寫出正確的遞歸程序。第六章會進行相關的學習。
</p>
</div>
</div>
<div id="outline-container-org18dfc0d" class="outline-2">
<h2 id="org18dfc0d"><span class="section-number-2">10</span> <span class="done DONE">DONE</span> Sets</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 15:16]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 14:55]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 14:55]--[2018-08-24 Fri 15:16] </span> <span class="timestamp">(0:21)</span>
</span>
</p>

<p>
<code>member</code> 這個函數判斷一個元素是不是在一個列表中，爲了返回更多的信息，它會返回包含要找的元素作爲第一個元素的一個列表，而不是僅僅返回布爾真值。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member 'a '<span class="org-rainbow-delimiters-depth-2">(</span>b c a<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
很多函數接受關鍵字參數，不限定順序。並且關鍵字參數總是可選的。
<code>member</code> 這個函數默認情況下使用=eql= 函數來判斷相等，可以換成想要的函數：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member '<span class="org-rainbow-delimiters-depth-2">(</span>a<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>b<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>c d<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>a<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:test</span> #'equal<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>A<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member '<span class="org-rainbow-delimiters-depth-2">(</span>a<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>b<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>c d<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>a<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
</pre>
</div>

<p>
<code>member</code> 還可以接受另外一個關鍵字參數 <code>key</code> ，它用來在對元素比較之前做一些操作：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member 'a '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>b<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>c d<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>a<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:key</span> #'car<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>A<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>member-if</code> 這個函數可以在列表中尋找滿足指定條件的元素：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member-if #'oddp '<span class="org-rainbow-delimiters-depth-2">(</span>2 3 4<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>3 4<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
簡單版本的 <code>member-if</code> 函數可以這樣定義：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-member-if</span> <span class="org-rainbow-delimiters-depth-2">(</span>fn lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>and <span class="org-rainbow-delimiters-depth-3">(</span>consp lst<span class="org-rainbow-delimiters-depth-3">)</span>
       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>funcall fn <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
           lst
           <span class="org-rainbow-delimiters-depth-4">(</span>our-member-if fn <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>adjoin</code> 這個函數會判斷一個元素是否存在一個列表中，如果存在，不做任何操作，否則就會 <code>cons</code> 這個元素到列表上，這個函數接受和 <code>member</code> 同樣的關鍵字參數。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>adjoin 'b '<span class="org-rainbow-delimiters-depth-2">(</span>c a b<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>C A B<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>adjoin 'b '<span class="org-rainbow-delimiters-depth-2">(</span>c a<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>B C A<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
集合的並集、交集、差集的函數如下：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>union '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>c a d<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>B C A D<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>intersection '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>c a d<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>C A<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>set-difference '<span class="org-rainbow-delimiters-depth-2">(</span>a b c<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>c a d<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
上面這些函數接受和 <code>member</code> 同樣的關鍵字參數。
</p>

<p>
集合操作不保持順序，所以函數的返回值也不保證會保持元素在原列表中的順序。
</p>
</div>
</div>
<div id="outline-container-org81bdedd" class="outline-2">
<h2 id="org81bdedd"><span class="section-number-2">11</span> <span class="done DONE">DONE</span> Sequences</h2>
<div class="outline-text-2" id="text-11">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 15:20]--[2018-08-24 Fri 15:46] </span> <span class="timestamp">(0:26)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 15:46]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 15:20]</span></span></li>
</ul>

<p>
<code>length</code> 返回一個列表的長度。
</p>

<p>
<code>subseq</code> 返回一個子列表，通過兩個下標指定，左閉右開區間。如果結束位置不指定，那麼返回之後的整個列表：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>subseq '<span class="org-rainbow-delimiters-depth-2">(</span>a b c d<span class="org-rainbow-delimiters-depth-2">)</span> 1 2<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-1">)</span>
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>subseq '<span class="org-rainbow-delimiters-depth-2">(</span>a b c d<span class="org-rainbow-delimiters-depth-2">)</span> 1<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>B C D<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>reverse</code> 函數返回逆序列表。
</p>

<p>
可以用這些函數定義一個判斷一個列表是不是迴文的：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">palindrome?</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>len <span class="org-rainbow-delimiters-depth-5">(</span>length lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>mid <span class="org-rainbow-delimiters-depth-6">(</span>floor len 2<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-rainbow-delimiters-depth-6">(</span>half <span class="org-rainbow-delimiters-depth-7">(</span>subseq lst 0 mid<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
        <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-6">(</span>evenp len<span class="org-rainbow-delimiters-depth-6">)</span>
            <span class="org-rainbow-delimiters-depth-6">(</span>equal half
                   <span class="org-rainbow-delimiters-depth-7">(</span>reverse <span class="org-rainbow-delimiters-depth-8">(</span>subseq lst mid<span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
            <span class="org-rainbow-delimiters-depth-6">(</span>equal half
                   <span class="org-rainbow-delimiters-depth-7">(</span>reverse <span class="org-rainbow-delimiters-depth-8">(</span>subseq lst <span class="org-rainbow-delimiters-depth-9">(</span>+ 1 mid<span class="org-rainbow-delimiters-depth-9">)</span><span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
這裏用到了一些到現在還沒有學到的知識，書上的版本會簡單一些，只考慮到了偶數長度的列表。另外，這裏可以使用 <code>let*</code> 。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>palindrome? '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>palindrome? '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 3 2 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>palindrome? '<span class="org-rainbow-delimiters-depth-2">(</span>1 2 2 1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>palindrome? '<span class="org-rainbow-delimiters-depth-2">(</span>1<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
</pre>
</div>

<p>
<code>sort</code> 函數接受一個列表和一個函數，返回排序之後的列表。注意：這個函數爲了效率考慮，會改變傳入的列表，所以如果不想要改變原來的列表，應該傳入一份拷貝。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>sort '<span class="org-rainbow-delimiters-depth-2">(</span>0 2 1 3 8<span class="org-rainbow-delimiters-depth-2">)</span> #'&gt;<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>8 3 2 1 0<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
取得一個列表第 n 大的元素：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">nthmost</span> <span class="org-rainbow-delimiters-depth-2">(</span>n lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>nth <span class="org-rainbow-delimiters-depth-3">(</span>- n 1<span class="org-rainbow-delimiters-depth-3">)</span>
       <span class="org-rainbow-delimiters-depth-3">(</span>sort <span class="org-rainbow-delimiters-depth-4">(</span>copy-list lst<span class="org-rainbow-delimiters-depth-4">)</span> #'&gt;<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>nthmost 2 '<span class="org-rainbow-delimiters-depth-2">(</span>0 2 1 3 8<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
3
</pre>
</div>

<p>
<code>every</code> 接受一個函數 A 和一個或多個列表。列表的個數必須要和函數 A 接受的參數個數一致。函數 A 返回布爾值，如果所有的測試結果是真，整個函數才返回真。
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>every #'oddp '<span class="org-rainbow-delimiters-depth-2">(</span>1 3 5<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>every #'&lt; '<span class="org-rainbow-delimiters-depth-2">(</span>1 3 5<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span>2 4 6 8<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
T
</pre>
</div>

<p>
如果多個列表長度不一樣，那麼測試的次數等於最短的列表的長度。
</p>

<p>
<code>some</code> 函數和 <code>every</code> 類似，只不過只要有一個測試爲真，整個函數就返回真。
</p>
</div>
</div>
<div id="outline-container-org094467b" class="outline-2">
<h2 id="org094467b"><span class="section-number-2">12</span> <span class="done DONE">DONE</span> Stacks</h2>
<div class="outline-text-2" id="text-12">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 15:55]--[2018-08-24 Fri 16:07] </span> <span class="timestamp">(0:12)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:07]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 15:55]</span></span></li>
</ul>

<p>
<code>push</code> 和 <code>pop</code> 這兩個宏可以模擬棧的行爲，在列表的開頭入棧和出棧。
<code>push</code> 會把元素加到列表開頭。 <code>pop</code> 從列表的開頭移除元素，並且返回移除的元素。
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>push obj lst<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
相當於：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>setf lst <span class="org-rainbow-delimiters-depth-2">(</span>cons obj lst<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
類似地，
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span>pop lst<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
相當於：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>x <span class="org-rainbow-delimiters-depth-4">(</span>car lst<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>setf lst <span class="org-rainbow-delimiters-depth-3">(</span>cdr lst<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  x<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
比如：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt;
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>x '<span class="org-rainbow-delimiters-depth-4">(</span>b<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"x = ~a~%"</span> x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>push 'a x<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>y x<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>format t <span class="org-string">"y = ~a~%"</span> y<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>pop x<span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>format t <span class="org-string">"x = ~a, y = ~a~%"</span> x y<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

x = <span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-1">)</span>
y = <span class="org-rainbow-delimiters-depth-1">(</span>A B<span class="org-rainbow-delimiters-depth-1">)</span>
x = <span class="org-rainbow-delimiters-depth-1">(</span>B<span class="org-rainbow-delimiters-depth-1">)</span>, y = <span class="org-rainbow-delimiters-depth-1">(</span>A B<span class="org-rainbow-delimiters-depth-1">)</span>
NIL
</pre>
</div>

<p>
定義一個迭代式的 <code>reverse</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-reverse</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>acc nil<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-4">(</span>x lst<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>push x acc<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    acc<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>pushnew</code> 這個宏是 <code>push</code> 的變種，但是它使用 <code>adjoin</code> 而不是 <code>cons</code>
：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>x '<span class="org-rainbow-delimiters-depth-4">(</span>a b<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>pushnew 'a x<span class="org-rainbow-delimiters-depth-2">)</span>
           <span class="org-rainbow-delimiters-depth-2">(</span>pushnew 'c x<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>C A B<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org5c2d133" class="outline-2">
<h2 id="org5c2d133"><span class="section-number-2">13</span> <span class="done DONE">DONE</span> Dotted Lists</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:20]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:16]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 16:15]--[2018-08-24 Fri 16:20] </span> <span class="timestamp">(0:05)</span>
</span>
</p>

<p>
<code>list</code> 創建的列表叫做 <code>proper list</code> ， <code>cons</code> 也可以構造 <code>dotted
  list</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>cons 'a <span class="org-rainbow-delimiters-depth-2">(</span>cons 'b 'c<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>A B . C<span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
<code>proper list</code> 也可以表示成 <code>dotted list</code> 。
</p>

<p>
判斷一個列表是不是 <code>proper list</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">proper-list?</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>or <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>and <span class="org-rainbow-delimiters-depth-4">(</span>consp lst<span class="org-rainbow-delimiters-depth-4">)</span>
           <span class="org-rainbow-delimiters-depth-4">(</span>proper-list? <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
這個函數其實是有問題的。比如如果是循環表的話，這個函數不能終止，循環表在第十二章會講到。
</p>
</div>
</div>
<div id="outline-container-org315438f" class="outline-2">
<h2 id="org315438f"><span class="section-number-2">14</span> <span class="done DONE">DONE</span> Assoc-lists</h2>
<div class="outline-text-2" id="text-14">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:36]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:21]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 16:21]--[2018-08-24 Fri 16:36] </span> <span class="timestamp">(0:15)</span>
</span>
</p>

<p>
conses 的列表叫做 <code>assoc-list</code> 或者 <code>alist</code> 。注意， <code>assoc-list</code> 效率很低。
</p>

<p>
<code>assoc</code> 這個函數可以根據 <code>key</code> 來取得對應的 <code>cons</code> ：
</p>

<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt;
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>trans '<span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>+ . <span class="org-string">"add"</span><span class="org-rainbow-delimiters-depth-5">)</span>
               <span class="org-rainbow-delimiters-depth-5">(</span>- . <span class="org-string">"substract"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"~a~%"</span> <span class="org-rainbow-delimiters-depth-3">(</span>assoc '+ trans<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"~a~%"</span> <span class="org-rainbow-delimiters-depth-3">(</span>assoc '- trans<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>format t <span class="org-string">"~a~%"</span> <span class="org-rainbow-delimiters-depth-3">(</span>assoc '/ trans<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>+ . add<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span>- . substract<span class="org-rainbow-delimiters-depth-1">)</span>
NIL
NIL
</pre>
</div>

<p>
簡單版本的 <code>assoc</code> 可以這樣實現：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">our-assoc</span> <span class="org-rainbow-delimiters-depth-2">(</span>key alist<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>and <span class="org-rainbow-delimiters-depth-3">(</span>consp alist<span class="org-rainbow-delimiters-depth-3">)</span>
       <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>pair <span class="org-rainbow-delimiters-depth-6">(</span>car alist<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
         <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-5">(</span>equal key <span class="org-rainbow-delimiters-depth-6">(</span>car pair<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
             pair
             <span class="org-rainbow-delimiters-depth-5">(</span>our-assoc key <span class="org-rainbow-delimiters-depth-6">(</span>cdr alist<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
像 <code>member</code> 一樣， <code>assoc</code> 也接受 <code>:test</code> 和 <code>:key</code> 關鍵字。和
<code>member</code> 有對應的 <code>member-if</code> 一樣， <code>assoc</code> 也有對應的 <code>assoc-if</code>
版本。
</p>
</div>
</div>
<div id="outline-container-orgce0994b" class="outline-2">
<h2 id="orgce0994b"><span class="section-number-2">15</span> <span class="done DONE">DONE</span> Example: Shortest Path</h2>
<div class="outline-text-2" id="text-15">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 17:37]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 16:37]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 16:37]--[2018-08-24 Fri 17:37] </span> <span class="timestamp">(1:00)</span>
</span>
</p>

<p>
使用 BFS 來求從起點到終點的最短路徑，每條邊的權值爲 1，圖用列表的列表表示，每個列表的第一個元素代表邊的起點，列表中的剩餘中的元素代表從這個點能夠到達的點。
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">new-paths</span> <span class="org-rainbow-delimiters-depth-2">(</span>path node net<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>mapcar #'<span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-4">(</span>x<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>cons x path<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
          <span class="org-rainbow-delimiters-depth-3">(</span>cdr <span class="org-rainbow-delimiters-depth-4">(</span>assoc node net<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">dfs</span> <span class="org-rainbow-delimiters-depth-2">(</span>end queue net<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null queue<span class="org-rainbow-delimiters-depth-3">)</span>
      nil
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>path <span class="org-rainbow-delimiters-depth-6">(</span>car queue<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-rainbow-delimiters-depth-6">(</span>node <span class="org-rainbow-delimiters-depth-7">(</span>car path<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
          <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-6">(</span>equal node end<span class="org-rainbow-delimiters-depth-6">)</span>
              <span class="org-rainbow-delimiters-depth-6">(</span>reverse path<span class="org-rainbow-delimiters-depth-6">)</span>
              <span class="org-rainbow-delimiters-depth-6">(</span>dfs end
                   <span class="org-rainbow-delimiters-depth-7">(</span>append <span class="org-rainbow-delimiters-depth-8">(</span>cdr queue<span class="org-rainbow-delimiters-depth-8">)</span>
                           <span class="org-rainbow-delimiters-depth-8">(</span>new-paths path node net<span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span>
                   net<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">shortest-path</span> <span class="org-rainbow-delimiters-depth-2">(</span>start end net<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>dfs end <span class="org-rainbow-delimiters-depth-3">(</span>list <span class="org-rainbow-delimiters-depth-4">(</span>list start<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> net<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
這個程序中隊列中記錄的不是點，而是路徑。由於沒有記錄哪些點已經訪問過，所以同一個點可能入隊多次。
</p>

<p>
在這個程序中，列表扮演了三種角色：1. 表示圖；2. 表示隊列；3. 表示路徑。
</p>
</div>
</div>
<div id="outline-container-orgb9cc677" class="outline-2">
<h2 id="orgb9cc677"><span class="section-number-2">16</span> <span class="done DONE">DONE</span> Garbage</h2>
<div class="outline-text-2" id="text-16">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 17:49]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 17:38]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 17:38]--[2018-08-24 Fri 17:49] </span> <span class="timestamp">(0:11)</span>
</span>
</p>

<p>
自動內存管理是 Lisp 一個重要的特性。Lisp 系統維護一個堆，並且系統有垃圾回收機制，會定期回收內存。在堆上申請內存一般叫做 <code>consing</code> 。
</p>

<p>
由於不用手動申請或者釋放內存，所以 Lisp 程序中不存在內存泄漏或者懸掛指針的 Bug。
</p>
</div>
</div>
<div id="outline-container-org13b73a5" class="outline-2">
<h2 id="org13b73a5"><span class="section-number-2">17</span> <span class="todo TODO">TODO</span> Exercise</h2>
<div class="outline-text-2" id="text-17">
<ul class="org-ul">
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 17:52]</span></span></li>
</ul>
</div>
<div id="outline-container-org50898c4" class="outline-3">
<h3 id="org50898c4"><span class="section-number-3">17.1</span> <span class="done DONE">DONE</span> Problem One</h3>
<div class="outline-text-3" id="text-17-1">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 17:54]--[2018-08-24 Fri 18:03] </span> <span class="timestamp">(0:09)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 18:40]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 17:54]</span></span></li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp">'<span class="org-rainbow-delimiters-depth-1">(</span>a . <span class="org-rainbow-delimiters-depth-2">(</span>b . <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>c . <span class="org-rainbow-delimiters-depth-5">(</span>d . nil<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span> . nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
'<span class="org-rainbow-delimiters-depth-1">(</span>A . <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>B . <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>C . <span class="org-rainbow-delimiters-depth-6">(</span><span class="org-rainbow-delimiters-depth-7">(</span>D . NIL<span class="org-rainbow-delimiters-depth-7">)</span> . NIL<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span> . NIL<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> . NIL<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
'<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>a . <span class="org-rainbow-delimiters-depth-4">(</span>b . nil<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span> . <span class="org-rainbow-delimiters-depth-3">(</span>c . nil<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> . <span class="org-rainbow-delimiters-depth-2">(</span>d . nil<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
'<span class="org-rainbow-delimiters-depth-1">(</span>a . <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>b . c<span class="org-rainbow-delimiters-depth-3">)</span> . d<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgae3f555" class="outline-3">
<h3 id="orgae3f555"><span class="section-number-3">17.2</span> <span class="done DONE">DONE</span> Problem Two</h3>
<div class="outline-text-3" id="text-17-2">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 18:41]--[2018-08-24 Fri 18:46] </span> <span class="timestamp">(0:05)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 18:46]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 18:41]</span></span></li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">new-union</span> <span class="org-rainbow-delimiters-depth-2">(</span>alst blst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null blst<span class="org-rainbow-delimiters-depth-3">)</span>
      alst
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-rainbow-delimiters-depth-5">(</span>elem <span class="org-rainbow-delimiters-depth-6">(</span>car blst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-5">(</span>member elem alst<span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>new-union alst
                       <span class="org-rainbow-delimiters-depth-6">(</span>cdr blst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
            <span class="org-rainbow-delimiters-depth-5">(</span>new-union <span class="org-rainbow-delimiters-depth-6">(</span>append alst <span class="org-rainbow-delimiters-depth-7">(</span>list elem<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
                       <span class="org-rainbow-delimiters-depth-6">(</span>cdr blst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-org1009b71" class="outline-3">
<h3 id="org1009b71"><span class="section-number-3">17.3</span> <span class="done DONE">DONE</span> Problem Three</h3>
<div class="outline-text-3" id="text-17-3">
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 18:46]--[2018-08-24 Fri 18:58] </span> <span class="timestamp">(0:12)</span>
</span>
</p>
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 18:58]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 18:46]</span></span></li>
</ul>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">occurrences</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>alist nil<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">dolist</span> <span class="org-rainbow-delimiters-depth-4">(</span>x lst<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-rainbow-delimiters-depth-6">(</span>match <span class="org-rainbow-delimiters-depth-7">(</span>assoc x alist<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
        <span class="org-rainbow-delimiters-depth-5">(</span><span class="org-keyword">if</span> match
            <span class="org-rainbow-delimiters-depth-6">(</span>setf <span class="org-rainbow-delimiters-depth-7">(</span>cdr match<span class="org-rainbow-delimiters-depth-7">)</span>
                  <span class="org-rainbow-delimiters-depth-7">(</span>+ 1 <span class="org-rainbow-delimiters-depth-8">(</span>cdr match<span class="org-rainbow-delimiters-depth-8">)</span><span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span>
            <span class="org-rainbow-delimiters-depth-6">(</span>setf alist
                  <span class="org-rainbow-delimiters-depth-7">(</span>cons <span class="org-rainbow-delimiters-depth-8">(</span>cons x 1<span class="org-rainbow-delimiters-depth-8">)</span>
                        alist<span class="org-rainbow-delimiters-depth-7">)</span><span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>sort alist #'&gt; <span class="org-builtin">:key</span> #'cdr<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orga58e06b" class="outline-3">
<h3 id="orga58e06b"><span class="section-number-3">17.4</span> <span class="done DONE">DONE</span> Problem Four</h3>
<div class="outline-text-3" id="text-17-4">
<ul class="org-ul">
<li>State "DONE"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 21:51]</span></span></li>
</ul>
<div class="org-src-container">
<pre class="src src-lisp">CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member '<span class="org-rainbow-delimiters-depth-2">(</span>a<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>a<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>b<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
NIL
CL-USER&gt; <span class="org-rainbow-delimiters-depth-1">(</span>member '<span class="org-rainbow-delimiters-depth-2">(</span>a<span class="org-rainbow-delimiters-depth-2">)</span> '<span class="org-rainbow-delimiters-depth-2">(</span><span class="org-rainbow-delimiters-depth-3">(</span>a<span class="org-rainbow-delimiters-depth-3">)</span> <span class="org-rainbow-delimiters-depth-3">(</span>b<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-builtin">:test</span> #'equal<span class="org-rainbow-delimiters-depth-1">)</span>
<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-rainbow-delimiters-depth-2">(</span>A<span class="org-rainbow-delimiters-depth-2">)</span> <span class="org-rainbow-delimiters-depth-2">(</span>B<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>
</pre>
</div>

<p>
因爲 <code>member</code> 默認使用 <code>eql</code> 來判斷相等。
</p>
</div>
</div>
<div id="outline-container-org8df58ac" class="outline-3">
<h3 id="org8df58ac"><span class="section-number-3">17.5</span> <span class="done DONE">DONE</span> Problem Five</h3>
<div class="outline-text-3" id="text-17-5">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 23:20]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 21:51]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 21:51]--[2018-08-24 Fri 23:20] </span> <span class="timestamp">(1:29)</span>
</span>
</p>

<p>
遞歸版本：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">pos+-rec-helper</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst i<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      nil
      <span class="org-rainbow-delimiters-depth-3">(</span>cons <span class="org-rainbow-delimiters-depth-4">(</span>+ i <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
            <span class="org-rainbow-delimiters-depth-4">(</span>pos+-rec-helper <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span> <span class="org-rainbow-delimiters-depth-5">(</span>+ i 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">pos+-rec</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>pos+-rec-helper lst 0<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>

<p>
迭代版本：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">pos+-iter</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">do</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>i 0 <span class="org-rainbow-delimiters-depth-5">(</span>+ i 1<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
       <span class="org-rainbow-delimiters-depth-4">(</span>tail lst <span class="org-rainbow-delimiters-depth-5">(</span>cdr tail<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
       <span class="org-rainbow-delimiters-depth-4">(</span>res nil<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>null tail<span class="org-rainbow-delimiters-depth-4">)</span> <span class="org-rainbow-delimiters-depth-4">(</span>reverse res<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>setf res <span class="org-rainbow-delimiters-depth-4">(</span>cons <span class="org-rainbow-delimiters-depth-5">(</span>+ i <span class="org-rainbow-delimiters-depth-6">(</span>car tail<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
                    res<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>

<p>
使用 <code>mapcar</code> 函數：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">inc-one</span> <span class="org-rainbow-delimiters-depth-2">()</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>x 0<span class="org-rainbow-delimiters-depth-4">)</span>
        <span class="org-rainbow-delimiters-depth-4">(</span>res<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">lambda</span> <span class="org-rainbow-delimiters-depth-4">(</span>item<span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>setf res <span class="org-rainbow-delimiters-depth-5">(</span>+ item x<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      <span class="org-rainbow-delimiters-depth-4">(</span>setf x <span class="org-rainbow-delimiters-depth-5">(</span>+ 1 x<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
      res<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">pos+-map</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">let</span> <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-rainbow-delimiters-depth-4">(</span>fun <span class="org-rainbow-delimiters-depth-5">(</span>inc-one<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
    <span class="org-rainbow-delimiters-depth-3">(</span>mapcar fun lst<span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>

<p>
這裏我使用了一個閉包，每次調用這個函數的時候，會把參數增加一個量，這個量會隨着調用次數自增。但是有沒有更好的實現方法呢？
</p>
</div>
</div>
<div id="outline-container-org503bfa9" class="outline-3">
<h3 id="org503bfa9"><span class="section-number-3">17.6</span> <span class="todo TODO">TODO</span> Problem Six</h3>
<div class="outline-text-3" id="text-17-6">
<ul class="org-ul">
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 23:21]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 23:21]--[2018-08-24 Fri 23:35] </span> <span class="timestamp">(0:14)</span>
</span>
</p>

<p>
這道題目其實沒有怎麼讀懂，大概寫了一下「不知道對不對」：
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">cons-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>a b<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span>cons b a<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">list-new</span> <span class="org-rainbow-delimiters-depth-2">()</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">length-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      0
      <span class="org-rainbow-delimiters-depth-3">(</span>+ 1 <span class="org-rainbow-delimiters-depth-4">(</span>length-new <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">member-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>obj lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>atom lst<span class="org-rainbow-delimiters-depth-3">)</span>
      nil
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>equal obj <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
          lst
          <span class="org-rainbow-delimiters-depth-4">(</span>member-new obj <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>

<p>
<code>list-new</code> 接收可變參數，還不會做。。
</p>
</div>
</div>

<div id="outline-container-org78f7f44" class="outline-3">
<h3 id="org78f7f44"><span class="section-number-3">17.7</span> <span class="done DONE">DONE</span> Problem Seven</h3>
<div class="outline-text-3" id="text-17-7">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 23:50]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 23:37]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 23:37]--[2018-08-24 Fri 23:50] </span> <span class="timestamp">(0:13)</span>
</span>
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">n-elts-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>n elt<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>&gt; n 1<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>cons n elt<span class="org-rainbow-delimiters-depth-3">)</span>
      elt<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">compr-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>elt n lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>n-elts-new n elt<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>equal elt <span class="org-rainbow-delimiters-depth-5">(</span>car lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-rainbow-delimiters-depth-4">(</span>compr-new elt
                     <span class="org-rainbow-delimiters-depth-5">(</span>+ 1 n<span class="org-rainbow-delimiters-depth-5">)</span>
                     <span class="org-rainbow-delimiters-depth-5">(</span>cdr lst<span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-rainbow-delimiters-depth-4">(</span>cons <span class="org-rainbow-delimiters-depth-5">(</span>n-elts-new n elt<span class="org-rainbow-delimiters-depth-5">)</span>
                <span class="org-rainbow-delimiters-depth-5">(</span>compr-new <span class="org-rainbow-delimiters-depth-6">(</span>car lst<span class="org-rainbow-delimiters-depth-6">)</span>
                           1
                           <span class="org-rainbow-delimiters-depth-6">(</span>cdr lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>

<span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">compress-new</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>consp lst<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>compr-new <span class="org-rainbow-delimiters-depth-4">(</span>car lst<span class="org-rainbow-delimiters-depth-4">)</span>
                 1
                 <span class="org-rainbow-delimiters-depth-4">(</span>cdr lst<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span>
      lst<span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>
</div>
</div>
<div id="outline-container-org5559a76" class="outline-3">
<h3 id="org5559a76"><span class="section-number-3">17.8</span> <span class="done DONE">DONE</span> Problem Eight</h3>
<div class="outline-text-3" id="text-17-8">
<ul class="org-ul">
<li>State "DONE"       from "TODO"       <span class="timestamp-wrapper"><span class="timestamp">[2018-08-25 Sat 00:43]</span></span></li>
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-24 Fri 23:51]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-25 Sat 00:28]--[2018-08-25 Sat 00:43] </span> <span class="timestamp">(0:15)</span>
</span>
</p>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-24 Fri 23:51]--[2018-08-25 Sat 00:21] </span> <span class="timestamp">(0:30)</span>
</span>
</p>

<div class="org-src-container">
<pre class="src src-lisp"><span class="org-rainbow-delimiters-depth-1">(</span><span class="org-keyword">defun</span> <span class="org-function-name">showdots</span> <span class="org-rainbow-delimiters-depth-2">(</span>lst<span class="org-rainbow-delimiters-depth-2">)</span>
  <span class="org-rainbow-delimiters-depth-2">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-3">(</span>null lst<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span>format t <span class="org-string">"~a"</span> nil<span class="org-rainbow-delimiters-depth-3">)</span>
      <span class="org-rainbow-delimiters-depth-3">(</span><span class="org-keyword">if</span> <span class="org-rainbow-delimiters-depth-4">(</span>consp lst<span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-rainbow-delimiters-depth-4">(</span><span class="org-keyword">progn</span> <span class="org-rainbow-delimiters-depth-5">(</span>format t <span class="org-string">"("</span><span class="org-rainbow-delimiters-depth-5">)</span>
                 <span class="org-rainbow-delimiters-depth-5">(</span>showdots <span class="org-rainbow-delimiters-depth-6">(</span>car lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
                 <span class="org-rainbow-delimiters-depth-5">(</span>format t <span class="org-string">" . "</span><span class="org-rainbow-delimiters-depth-5">)</span>
                 <span class="org-rainbow-delimiters-depth-5">(</span>showdots <span class="org-rainbow-delimiters-depth-6">(</span>cdr lst<span class="org-rainbow-delimiters-depth-6">)</span><span class="org-rainbow-delimiters-depth-5">)</span>
                 <span class="org-rainbow-delimiters-depth-5">(</span>format t <span class="org-string">")"</span><span class="org-rainbow-delimiters-depth-5">)</span><span class="org-rainbow-delimiters-depth-4">)</span>
          <span class="org-rainbow-delimiters-depth-4">(</span>format t <span class="org-string">"~a"</span> lst<span class="org-rainbow-delimiters-depth-4">)</span><span class="org-rainbow-delimiters-depth-3">)</span><span class="org-rainbow-delimiters-depth-2">)</span><span class="org-rainbow-delimiters-depth-1">)</span>   
</pre>
</div>

<p>
這道題目正好可以驗證第一道題目。才發現第一道題的第二問做錯了。。
</p>
</div>
</div>
<div id="outline-container-org5103d70" class="outline-3">
<h3 id="org5103d70"><span class="section-number-3">17.9</span> <span class="todo TODO">TODO</span> Problem Nine</h3>
<div class="outline-text-3" id="text-17-9">
<ul class="org-ul">
<li>State "TODO"       from              <span class="timestamp-wrapper"><span class="timestamp">[2018-08-25 Sat 00:49]</span></span></li>
</ul>
<p>
<span class="timestamp-wrapper">
<span class="timestamp-kwd">CLOCK:</span> <span class="timestamp">[2018-08-25 Sat 00:49]--[2018-08-25 Sat 00:59] </span> <span class="timestamp">(0:10)</span>
</span>
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">

<br/>
<br/>
<p class='author'>Author: liuxueyang (<a href="mailto:liuxueyang457@gmail.com">liuxueyang457@gmail.com</a>)</p>
<p class='date'>Date: 2018-08-21 Tue 00:00</p>
<p class='creator'>Emacs 26.1 (Org mode 9.1.9)</p>
<p class='validation'><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>

<script>
var idcomments_acct = 'ab93a85474f166ce7e6c4b85791a447d';
var idcomments_post_id;
var idcomments_post_url;
</script>

 <div id='comments'>
  <div class='intense_debate' id='intense_debate_btn'
       onclick='intense_debate()'>点击加载评论
  </div>
  <div id='intense_debate_thread'></div>
  <span id='IDCommentsPostTitle' style='display:none'></span>
 </div>

 <script>
     let disqus_loaded = false;
     function intense_debate() {
         if (!disqus_loaded) {
             disqus_loaded = true;
             (function () {
                 var d = document, s = d.createElement('script');
                 s.src = 'https://www.intensedebate.com/js/genericCommentWrapperV2.js';
                 d.body.appendChild(s);
             })();
         }
         document.getElementById('intense_debate_btn').style.display = 'none';
         return false;
     }
 </script>
</div>
</body>
</html>
